# NFR — Нефункциональные требования (Reading List API)

## Обзор

Данный документ содержит измеримые нефункциональные требования (NFR) для сервиса Reading List API — приложения для ведения списка чтения книг.

---

## Таблица NFR

| ID | Название | Описание | Метрика/Порог | Проверка (чем/где) | Компонент | Приоритет |
|----|----------|----------|---------------|-------------------|-----------|-----------|
| **NFR-001** | Время отклика API | Время ответа для CRUD-операций с записями | p95 ≤ 200 мс | pytest-benchmark / Locust нагрузочные тесты | API endpoints | High |
| **NFR-002** | Доступность сервиса | Uptime сервиса в рабочие часы | SLA ≥ 99.5% | Health-check мониторинг (`/health`) | Весь сервис | Critical |
| **NFR-003** | Валидация входных данных | Защита от инъекций и XSS через строгую валидацию | 100% запросов валидируются Pydantic, 0 уязвимостей типа injection | Unit-тесты валидации, Bandit SAST | Models, Endpoints | Critical |
| **NFR-004** | Rate Limiting | Ограничение количества запросов от одного клиента | ≤ 100 запросов/мин на IP | Middleware rate limiter, интеграционные тесты | API Gateway | High |
| **NFR-005** | Безопасность зависимостей | Отсутствие известных уязвимостей в зависимостях | 0 Critical/High уязвимостей (возраст < 7 дней) | pip-audit / Safety в CI | requirements.txt | Critical |
| **NFR-006** | Размер ответа API | Лимит на количество возвращаемых записей | ≤ 100 записей на страницу (пагинация) | Unit-тесты пагинации | GET /entries | Medium |
| **NFR-007** | Логирование операций | Аудит всех модифицирующих операций (CREATE/UPDATE/DELETE) | 100% операций логируются с timestamp и action type | Структурированные логи (JSON), тест на наличие логов | Все endpoints | High |
| **NFR-008** | Ограничение размера запроса | Защита от DoS через большие payload | Max body size ≤ 64 KB | Middleware проверка, интеграционные тесты | API Gateway | Medium |
| **NFR-009** | Таймауты соединений | Предотвращение зависания при медленных клиентах | Timeout ≤ 30 сек на запрос | Конфигурация сервера, нагрузочные тесты | HTTP Server | Medium |
| **NFR-010** | Код покрытия тестами | Минимальный уровень тестового покрытия | Coverage ≥ 80% | pytest-cov в CI | Весь код | High |

---

## Детализация ключевых NFR

### NFR-001: Время отклика API

**Цель:** Обеспечить быстрый отклик для пользователей при работе со списком чтения.

**Метрики:**
- p50 (медиана): ≤ 50 мс
- p95: ≤ 200 мс
- p99: ≤ 500 мс

**Измерение:**
- Нагрузочные тесты с помощью Locust/k6
- Метрики в CI через pytest-benchmark

---

### NFR-003: Валидация входных данных

**Цель:** Предотвратить атаки через вредоносные данные.

**Текущая реализация:**
- Pydantic модели с ограничениями полей:
  - `title`: 1-200 символов
  - `author`: 1-100 символов  
  - `notes`: до 1000 символов
  - `status`: enum (to_read, reading, completed)

**Проверка:**
- SAST сканер Bandit в CI
- Unit-тесты граничных случаев

---

### NFR-005: Безопасность зависимостей

**Цель:** Исключить использование пакетов с известными уязвимостями.

**Политика:**
- Critical уязвимости: исправление в течение 24 часов
- High уязвимости: исправление в течение 7 дней
- Medium/Low: в рамках регулярного обновления

**Инструменты:**
- `pip-audit` — сканирование в CI
- Dependabot — автоматические PR на обновление

---

### NFR-007: Логирование операций

**Цель:** Обеспечить возможность аудита и расследования инцидентов.

**Формат лога:**
```json
{
  "timestamp": "2024-12-09T10:30:00Z",
  "level": "INFO",
  "action": "CREATE_ENTRY",
  "entry_id": 42,
  "client_ip": "192.168.1.1",
  "response_time_ms": 45
}
```

**Требования:**
- Все CREATE/UPDATE/DELETE операции логируются
- Логи не содержат PII/чувствительных данных
- Retention: 30 дней

---

## История изменений

| Дата | Версия | Автор | Изменения |
|------|--------|-------|-----------|
| 2024-12-09 | 1.0 | Атаханов Н.Р. | Первоначальная версия |

